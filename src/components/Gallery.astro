---
const images = [
  { src: "/images/wedding1.jpg", alt: "Wedding Photo 1" },
  { src: "/images/celebration.jpg", alt: "Celebration Photo" },
  { src: "/images/wedding2.jpg", alt: "Wedding Photo 2" },
  { src: "/images/memorial.jpg", alt: "Memorial Service" },
  { src: "/images/birthday.jpg", alt: "Birthday Ceremony" },
  { src: "/images/wedding3.jpg", alt: "Wedding Photo 3" },
];
---

<section id="gallery" class="gallery">
  <div class="container">
    <h2>Gallery</h2>
    <div class="gallery-grid">
      {
        images.map((image, index) => (
          <div class="gallery-item" data-index={index}>
            <img src={image.src} alt={image.alt} loading="lazy" />
          </div>
        ))
      }
    </div>
  </div>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="lightbox">
    <button class="close-btn">&times;</button>
    <button class="nav-btn prev-btn">&#10094;</button>
    <button class="nav-btn next-btn">&#10095;</button>
    <div class="lightbox-content">
      <img id="lightbox-img" src="" alt="" />
      <div class="image-counter">
        <span id="current-image">1</span> / <span id="total-images"
          >{images.length}</span
        >
      </div>
    </div>
  </div>
</section>

<script>
  const images = [
    { src: "/images/wedding1.jpg", alt: "Wedding Photo 1" },
    { src: "/images/celebration.jpg", alt: "Celebration Photo" },
    { src: "/images/wedding2.jpg", alt: "Wedding Photo 2" },
    { src: "/images/memorial.jpg", alt: "Memorial Service" },
    { src: "/images/birthday.jpg", alt: "Birthday Ceremony" },
    { src: "/images/wedding3.jpg", alt: "Wedding Photo 3" },
  ];

  let currentIndex = 0;
  let touchStartX = 0;
  let touchEndX = 0;

  // Select elements once
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById(
    "lightbox-img"
  ) as HTMLImageElement;
  const currentImageSpan = document.getElementById("current-image");
  const closeBtn = document.querySelector(".close-btn");
  const prevBtn = document.querySelector(".prev-btn");
  const nextBtn = document.querySelector(".next-btn");
  const galleryItems = document.querySelectorAll(".gallery-item");

  // --- REVEAL ON SCROLL LOGIC ---
  const revealObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("reveal");
          revealObserver.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.1 }
  );

  galleryItems.forEach((item, index) => {
    (item as HTMLElement).style.transitionDelay = `${(index % 3) * 0.1}s`;
    revealObserver.observe(item);
  });

  // --- LIGHTBOX FUNCTIONS ---
  function updateLightboxImage() {
    if (lightboxImg && currentImageSpan) {
      lightboxImg.src = images[currentIndex].src;
      lightboxImg.alt = images[currentIndex].alt;
      currentImageSpan.textContent = (currentIndex + 1).toString();
    }
  }

  function openLightbox(index: number) {
    currentIndex = index;
    updateLightboxImage();
    lightbox?.classList.add("active");
    document.body.style.overflow = "hidden";
  }

  function closeLightbox() {
    lightbox?.classList.remove("active");
    document.body.style.overflow = "";
  }

  function showNext() {
    currentIndex = (currentIndex + 1) % images.length;
    updateLightboxImage();
  }

  function showPrev() {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    updateLightboxImage();
  }

  // --- SWIPE GESTURE LOGIC ---
  function handleGesture() {
    const swipeThreshold = 50;
    if (touchEndX < touchStartX - swipeThreshold) showNext();
    if (touchEndX > touchStartX + swipeThreshold) showPrev();
  }

  // --- EVENT LISTENERS ---
  galleryItems.forEach((item) => {
    item.addEventListener("click", () => {
      const index = parseInt(item.getAttribute("data-index") || "0");
      openLightbox(index);
    });
  });

  closeBtn?.addEventListener("click", closeLightbox);
  nextBtn?.addEventListener("click", showNext);
  prevBtn?.addEventListener("click", showPrev);

  lightbox?.addEventListener(
    "touchstart",
    (e: TouchEvent) => {
      touchStartX = e.changedTouches[0].screenX;
    },
    { passive: true }
  );

  lightbox?.addEventListener(
    "touchend",
    (e: TouchEvent) => {
      touchEndX = e.changedTouches[0].screenX;
      handleGesture();
    },
    { passive: true }
  );

  lightbox?.addEventListener("click", (e) => {
    if (e.target === lightbox) closeLightbox();
  });

  document.addEventListener("keydown", (e) => {
    if (!lightbox?.classList.contains("active")) return;
    if (e.key === "Escape") closeLightbox();
    if (e.key === "ArrowRight") showNext();
    if (e.key === "ArrowLeft") showPrev();
  });
</script>
